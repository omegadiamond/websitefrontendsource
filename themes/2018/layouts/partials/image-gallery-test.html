<link rel="stylesheet" href="{{.Site.BaseURL}}css/mdl-ext/mdl-ext-eqjs.min.css">
<link rel="stylesheet" href="{{.Site.BaseURL}}css/mdl-ext/dialog-polyfill.css">


<ul id="lightboard-for-lightbox-img" class="mdlext-lightboard mdlext-js-lightboard mdl-js-ripple-effect mdl-js-ripple-effect--ignore-events">
    <li class="mdlext-lightboard__slide" data-details="[
    { 'name': 'Title',            'value': 'Northern goshawk with prey' },
    { 'name': 'Copyright &copy;', 'value': 'Leif Olsen' }]">
        <a href="{{.Site.BaseURL}}img/gallery-example.jpg" class="mdlext-lightboard__slide__frame">
            <figure>
                <img src="{{.Site.BaseURL}}img/gallery-example.jpg" title="First One">
                <figcaption>First One</figcaption>
            </figure>
        </a>
    </li>

    <li class="mdlext-lightboard__slide" data-details="[
    { 'name': 'Title',            'value': 'Northern goshawk with prey' },
    { 'name': 'Copyright &copy;', 'value': 'Leif Olsen' }]">
        <a href="https://omegadiamond.com/system/files/images/IMG_2039%28web%29.preview.jpg" class="mdlext-lightboard__slide__frame">
            <figure>
                <img src="https://omegadiamond.com/system/files/images/IMG_2039%28web%29.preview.jpg" title="Another One">
                <figcaption>Another One</figcaption>
            </figure>
        </a>
    </li>

    <li class="mdlext-lightboard__slide" data-details="[
    { 'name': 'Title',            'value': 'Northern goshawk with prey' },
    { 'name': 'Copyright &copy;', 'value': 'Leif Olsen' }]">
        <a href="https://omegadiamond.com/system/files/images/BRS_On_Rail_Bottom.jpg" class="mdlext-lightboard__slide__frame">
            <figure>
                <img src="https://omegadiamond.com/system/files/images/BRS_On_Rail_Bottom.jpg" title="One More">
                <figcaption>One More</figcaption>
            </figure>
        </a>
    </li>

    <li class="mdlext-lightboard__slide" data-details="[
    { 'name': 'Title',            'value': 'Northern goshawk with prey' },
    { 'name': 'Copyright &copy;', 'value': 'Leif Olsen' }]">
        <a href="{{.Site.BaseURL}}img/gallery-example2.jpg" class="mdlext-lightboard__slide__frame">
            <figure>
                <img src="{{.Site.BaseURL}}img/gallery-example2.jpg" title="Last One">
                <figcaption>Last One</figcaption>
            </figure>
        </a>
    </li>
</ul>



<dialog id="lightbox-dialog-img" class="mdlext-dialog">
    <div id="lightbox-img" class="mdlext-lightbox mdlext-js-lightbox mdl-card mdl-shadow--4dp">
        <div class="mdl-card__menu mdl-color-text--white mdl-typography--body-2-color-contrast">
            <button data-action="close" class="mdl-button mdl-button--icon mdl-js-button" title="Close">
                <i class="material-icons">close</i>
            </button>
        </div>
        <figure class="mdl-card__title">
            <img src="" draggable="true" alt="">
            <figcaption data-action="select">Details</figcaption>
        </figure>
        <footer data-action="select" class="mdl-card__actions mdl-card--border">
            <div class="mdl-card__supporting-text">
                Image title
            </div>
            <nav>
                <button data-action="first" class="mdl-button mdl-button--icon mdl-js-button" title="First">
                    <i class="material-icons">first_page</i>
                </button>
                <button data-action="prev" class="mdl-button mdl-button--icon mdl-js-button" title="Previous">
                    <i class="material-icons">chevron_left</i>
                </button>
                <button data-action="next" class="mdl-button mdl-button--icon mdl-js-button" title="Next">
                    <i class="material-icons">chevron_right</i>
                </button>
                <button data-action="last" class="mdl-button mdl-button--icon mdl-js-button" title="Last">
                    <i class="material-icons">last_page</i>
                </button>
                <button data-action="select" class="mdl-button mdl-button--icon mdl-js-button" title="Details">
                    <i class="material-icons">info_outline</i>
                </button>

                <button data-action="close" class="mdl-button mdl-button--icon mdl-js-button" title="Close">
                    <i class="material-icons">close</i>
                </button>
            </nav>
        </footer>
    </div>
</dialog>


<script src="https://code.getmdl.io/1.3.0/material.min.js"></script>
<script src="https://cdn.polyfill.io/v2/polyfill.min.js?features=default,es6"></script>
<script src="{{.Site.BaseURL}}js/mdl-ext/dialog-polyfill.js"></script>
<script src="{{.Site.BaseURL}}js/mdl-ext/mdl-ext.min.js"></script>

<script>
    window.addEventListener('load', function() {
        var dialog = document.querySelector('#lightbox-dialog-img');

        // A dialog element MUST be a child of document.body!!
        // In a SPA you should choose a more robust strategy than the simple if provided here
        if(dialog.parentNode.tagName !== 'BODY') {
            document.body.appendChild(dialog);
        }

        if (!('showModal' in dialog)) {
            dialogPolyfill.registerDialog(dialog);
        }

        var currentSlide = null;
        var lightboard = document.querySelector('#lightboard-for-lightbox-img');
        var slides = lightboard.querySelectorAll('.mdlext-lightboard__slide');

        lightboard.addEventListener('select', function(e) {
            currentSlide = e.detail.source;
            for (var i = 0, n = slides.length; i < n; i++) {
                if(currentSlide ===  slides[i]) {
                    break;
                }
            }
            var prevSlide = slides[ i > 0   ? i-1 : n-1 ];
            var nextSlide = slides[ i < n-1 ? i+1 : 0];
            showImage(currentSlide, prevSlide, nextSlide);
        });

        var lightbox = dialog.querySelector('.mdlext-lightbox');

        lightbox.addEventListener('action', function(e) {
            if(e.detail.action === 'close') {
                dialog.close();
            }
            else if(e.detail.action === 'select') {
                var figcaption = lightbox.querySelector('figure figcaption');
                if(figcaption.classList.contains('mdlext-lightbox__show-figcaption')) {
                    figcaption.classList.remove('mdlext-lightbox__show-figcaption');
                }
                else {
                    figcaption.classList.add('mdlext-lightbox__show-figcaption');
                }
            }
            else {
                var i = 0;
                var n = slides.length;

                if(e.detail.action === 'first') {
                    currentSlide = slides[0];
                }
                else if(e.detail.action === 'prev' || e.detail.action === 'next') {
                    for (var j = 0; j < n; j++) {
                        if(currentSlide ===  slides[j]) {
                            if(e.detail.action === 'prev') {
                                i = j > 0 ? j-1 : n-1;
                                currentSlide = slides[i];
                            }
                            else if(e.detail.action === 'next') {
                                i = j < n-1 ? j+1 : 0;
                                currentSlide = slides[i];
                            }
                            break;
                        }
                    }
                }
                else if(e.detail.action === 'last') {
                    i = slides.length-1;
                    currentSlide = slides[i];
                }
                var prevSlide = slides[ i > 0   ? i-1 : n-1 ];
                var nextSlide = slides[ i < n-1 ? i+1 : 0];
                showImage(currentSlide, prevSlide, nextSlide);
            }
        });

        function showImage(slide, prevSlide, nextSlide) {

            var slideAnchor = slide.querySelector('a');
            var slideImg = slide.querySelector('img');
            var img = dialog.querySelector('img');
            var supportingText = dialog.querySelector('.mdl-card__supporting-text');
            var imageDetails = dialog.querySelector('figcaption');
            var href = slideAnchor.getAttribute('href');
            href = href && href.indexOf('#') === 0 ? slideImg.getAttribute('src') : href;
            img.setAttribute('src', href);
            img.setAttribute('alt', slideImg.getAttribute('title') || '');
            img.setAttribute('title', slideImg.getAttribute('title') || '');
            supportingText.innerHTML = slideImg.getAttribute('title') || '';

            // Lazy coder :)
            slideAnchor = prevSlide.querySelector('a');
            slideImg = prevSlide.querySelector('img');
            href = slideAnchor.getAttribute('href');
            href = href && href.indexOf('#') === 0 ? slideImg.getAttribute('src') : href;
            img.setAttribute('data-img-url-prev', href);

            slideAnchor = nextSlide.querySelector('a');
            slideImg = nextSlide.querySelector('img');
            href = slideAnchor.getAttribute('href');
            href = href && href.indexOf('#') === 0 ? slideImg.getAttribute('src') : href;
            img.setAttribute('data-img-url-next', href);


            var detailsHtml  = '';
            var detailsArray = JSON.parse(slide.getAttribute('data-details').replace(/'/g, '"'));

            if(detailsArray != null) {
                detailsHtml = '<table><tbody>';
                for (var i = 0, n = detailsArray.length; i < n; i++) {
                    detailsHtml += '<tr><th>' + detailsArray[i].name + '</th><td>' + detailsArray[i].value + '</td></tr>';

                    if(!supportingText.innerHTML && detailsArray[i].name.toLowerCase() === 'title') {
                        supportingText.innerHTML = detailsArray[i].value;
                    }
                }
                detailsHtml += '</tbody></table>';
            }

            imageDetails.innerHTML = '';
            imageDetails.insertAdjacentHTML('afterbegin', detailsHtml);

            if(!dialog.open) {
                dialog.showModal();
            }
        }
    });
</script>