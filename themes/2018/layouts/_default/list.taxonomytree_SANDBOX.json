{{- $taxList := .Site.Data.taxonomies.taxonomies -}}
{{- $.Scratch.Set "rootCount" 0 -}}
{{- range $rootKey, $tax := $taxList -}}
{{- if eq $tax.root true -}}
{{- $.Scratch.Add "rootCount" 1 -}}
{{- end -}}
{{- end -}}

{{- $.Scratch.Set "count" 0 -}}

{
  "taxonomies" : [

{{- range $rootKey, $tax := .Site.Data.taxonomies.taxonomies -}}
  {{- if eq $tax.root true -}}
    {
        "key" : "{{ $rootKey }}"

    {{- if $tax.children -}}
      {{- range $key2 := $tax.children}}
        {{- $tax := index $.Site.Data.taxonomies.taxonomies (string $key2) -}}

        {{- if $tax.children -}}
          {{- range $key3 := $tax.children -}}
            {{- $tax := index $.Site.Data.taxonomies.taxonomies (string $key3) -}}

            {{- if $tax.children -}}
              {{- range $key4 := $tax.children -}}
                {{- $tax := index $.Site.Data.taxonomies.taxonomies (string $key4) -}}

                {{- $.Scratch.Add (printf "%s%s" $key3 "_3") (slice (dict "key" $key4 "name" $tax.name)) -}}
              {{- end -}}
            {{- end -}}

            {{- $.Scratch.Add (printf "%s%s" $key2 "_2") (slice (dict "key" $key3 "name" $tax.name "children" ($.Scratch.Get (printf "%s%s" $key3 "_3")))) -}}
          {{- end -}}
        {{- end -}}

        {{- $.Scratch.Add (printf "%s%s" $rootKey "_0") (slice (dict "key" $key2 "name" $tax.name "children" ($.Scratch.Get (printf "%s%s" $key2 "_2")))) -}}
      {{- end -}}
    {{- end -}}

    {{- $.Scratch.Set (printf "%s%s" $rootKey $rootKey) (dict "id" $rootKey "name" $tax.name "root" $tax.root "children" ($.Scratch.Get (printf "%s%s" $rootKey "_0"))) -}}
    {{- $.Scratch.Add "cats" (slice ($.Scratch.Get (printf "%s%s" $rootKey $rootKey))) -}}

    }{{- if ne (add ($.Scratch.Get "count") 1) ($.Scratch.Get "rootCount") -}},{{- end -}}
    {{- $.Scratch.Add "count" 1 -}}
  {{- end -}}
{{- end -}}


]
}
