{{- $taxList := .Site.Data.taxonomies.taxonomies -}}
{{- $.Scratch.Set "rootCount" 0 -}}
{{- $.Scratch.Set "count" 0 -}}
{{- range $rootKey, $tax := $taxList -}}
{{- if eq $tax.root true -}}
{{- $.Scratch.Add "rootCount" 1 -}}
{{- end -}}
{{- end -}}

[
{{- range $rootKey, $tax := $taxList -}}
{{- if eq $tax.root true -}}

  {
  "key" : "{{- $rootKey -}}",
  "name": "{{- $tax.name -}}",
  "weight": {{- $tax.root_weight -}},
  "children": [
  {{- if $tax.children -}}
    {{- partial "taxonomytree-rec.json" (dict "children" $tax.children "taxList" $taxList) -}}
  {{- end -}}
  ]

  }{{- if ne (add ($.Scratch.Get "count") 1) ($.Scratch.Get "rootCount") -}},{{- end -}}

{{- $.Scratch.Add "count" 1}}
{{- end -}}
{{- end -}}
]
