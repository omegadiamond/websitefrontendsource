{{- $taxList := .Site.Data.taxonomies.taxonomies -}}
{{- $.Scratch.Set "count" 0 -}}

[
{{- range $rootKey, $tax := $taxList -}}

  {
  "key" : "{{- $rootKey -}}",
  "name": "{{- $tax.name -}}"
  {{- if $tax.root -}}, "root": {{- $tax.root -}}{{- end -}}
  {{- if $tax.root_weight -}}, "weight": "{{- $tax.root_weight -}}"{{- end -}}
  {{- if $tax.children -}}
    , "children": [
    {{- range $chindex, $child := $tax.children -}}
      "{{- $child -}}"{{- if ne (add $chindex 1) (len $tax.children) -}},{{- end -}}
    {{- end -}}
    ]
  {{- end -}}


  {{- $.Scratch.Set "parentStr" "" -}}
  {{- range $key2, $tax2 := $taxList -}}
    {{- if (in $tax2.children $rootKey) -}}

      {{- $.Scratch.Add "parentStr" (printf "%s%s" $key2 ",") -}}
      {{- $partial := partial "taxonomylist-rec.json" (dict "taxList" $taxList "category" $key2) -}}
      {{- if $partial -}}
        {{- $.Scratch.Add "parentStr" $partial -}}
      {{- end -}}


    {{- end -}}
  {{- end -}}

  {{- if ($.Scratch.Get "parentStr") -}}
    {{- $parentStr := substr ($.Scratch.Get "parentStr") 0 -1 -}}
    {{- $splitted := (split $parentStr ",") | uniq -}}
    , "parents" : [
    {{- range $splindex, $spl := $splitted -}}
      {{- printf "%s%s%s" "\"" $spl "\"" -}}{{- if ne (add $splindex 1) (len $splitted) -}},{{- end -}}
    {{- end -}}
    ]
  {{- end -}}

  }{{- if ne (add ($.Scratch.Get "count") 1) (len $taxList) -}},{{- end -}}

  {{- $.Scratch.Add "count" 1}}
{{- end -}}
]
